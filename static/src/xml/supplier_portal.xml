<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="stock_lot_packing_import.SupplierPortalApp">
        <div class="o_portal_wrapper">
            
            <!-- HEADER -->
            <header class="o_portal_header">
                <div class="brand">
                    <i class="fa fa-cubes me-2"/>PORTAL <span class="ms-1">PROVEEDOR</span>
                </div>
                <div class="po-info">
                    <div><span class="label">Orden de Compra:</span> <span class="value" t-esc="state.data.poName"/></div>
                    <div><span class="label">Recepción:</span> <span class="value" t-esc="state.data.pickingName"/></div>
                </div>
            </header>

            <!-- CONTENIDO -->
            <div class="o_portal_container pb-5 mb-5">
                
                <!-- SECCIÓN: DATOS DE EMBARQUE -->
                <div class="shipment-card">
                    <div class="card-header">
                        <i class="fa fa-ship fa-lg"></i>
                        <h3 data-i18n="shipment_data_title">Datos de Embarque</h3>
                    </div>
                    <div class="card-body" id="shipment-info-form">
                        
                        <!-- NOTA INFORMATIVA -->
                        <div class="alert alert-info mb-3 p-2" style="font-size: 0.85rem;">
                            <i class="fa fa-info-circle me-1"></i> 
                            <span data-i18n="msg_multi_pl_info">Los datos de Documentación y Logística se mantendrán para todos los contenedores. Solo debe actualizar la sección 'Detalles de Carga' y 'Productos' por cada Packing List.</span>
                        </div>

                        <div class="modern-form-grid">
                            
                            <!-- SECCIÓN DOCUMENTACIÓN (GLOBAL) -->
                            <div class="full-width form-section-title">
                                <i class="fa fa-file-text-o me-2"></i> Documentación (Global)
                            </div>
                            
                            <div class="form-group">
                                <label><span data-i18n="lbl_invoice">No. de Factura</span></label>
                                <input type="text" id="h-invoice" class="form-control" data-i18n-placeholder="ph_invoice" placeholder="Ej. INV-2024-001"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_date">Fecha Embarque</span></label>
                                <input type="date" id="h-date" class="form-control"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_proforma">No. Proforma (PI)</span></label>
                                <input type="text" id="h-proforma" class="form-control" data-i18n-placeholder="ph_proforma" placeholder="Ej. PI-9920"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_bl">No. B/L</span></label>
                                <input type="text" id="h-bl" class="form-control" data-i18n-placeholder="ph_bl" placeholder="Ej. COSU123456"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_payment">Forma de Pago</span></label>
                                <input type="text" id="h-payment" class="form-control" data-i18n-placeholder="ph_payment" placeholder="Ej. T/T 30%"/>
                            </div>

                            <!-- SECCIÓN LOGÍSTICA (GLOBAL) -->
                            <div class="full-width form-section-title mt-3">
                                <i class="fa fa-globe me-2"></i> <span data-i18n="sec_logistics">Logística (Global)</span>
                            </div>

                            <div class="form-group">
                                <label><span data-i18n="lbl_origin">Origen (Puerto)</span></label>
                                <input type="text" id="h-origin" class="form-control" data-i18n-placeholder="ph_origin" placeholder="Ej. Shanghai"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_dest">Destino (Puerto)</span></label>
                                <input type="text" id="h-dest" class="form-control" data-i18n-placeholder="ph_dest" placeholder="Ej. Manzanillo"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_country">País Origen</span></label>
                                <input type="text" id="h-country" class="form-control" data-i18n-placeholder="ph_country" placeholder="Ej. China"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_vessel">Buque / Viaje</span></label>
                                <input type="text" id="h-vessel" class="form-control" data-i18n-placeholder="ph_vessel" placeholder="Ej. MAERSK SEALAND"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_incoterm">Incoterm</span></label>
                                <input type="text" id="h-incoterm" class="form-control" data-i18n-placeholder="ph_incoterm" placeholder="Ej. CIF"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_status">Estatus</span></label>
                                <select id="h-status" class="form-control">
                                    <option value="" data-i18n="opt_select">Seleccionar...</option>
                                    <option value="En Producción" data-i18n="opt_production">En Producción</option>
                                    <option value="En Puerto Origen" data-i18n="opt_origin_port">En Puerto Origen</option>
                                    <option value="En Tránsito" data-i18n="opt_transit">En Tránsito</option>
                                    <option value="En Puerto Destino" data-i18n="opt_dest_port">En Puerto Destino</option>
                                </select>
                            </div>

                            <!-- SECCIÓN CARGA (VARIABLE POR CONTENEDOR) -->
                            <div class="full-width form-section-title mt-3 text-warning">
                                <i class="fa fa-cubes me-2"></i> <span data-i18n="sec_cargo">Detalles de Carga (Contenedor Actual)</span>
                            </div>

                            <div class="form-group">
                                <label class="text-warning"><span data-i18n="lbl_container">No. Contenedor</span> *</label>
                                <input type="text" id="h-cont-no" class="form-control border-warning" data-i18n-placeholder="ph_container" placeholder="Ej. MSKU1234567"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_seal">No. Sello</span></label>
                                <input type="text" id="h-seal" class="form-control" data-i18n-placeholder="ph_seal" placeholder="Ej. 123456"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_cont_type">Tipo Contenedor</span></label>
                                <input type="text" id="h-type" class="form-control" data-i18n-placeholder="ph_cont_type" placeholder="Ej. 40HC, 20GP"/>
                            </div>
                            
                            <div class="form-group">
                                <label><span data-i18n="lbl_packages">Total Paquetes</span></label>
                                <input type="number" id="h-pkgs" class="form-control" placeholder="0"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_weight">Peso Bruto (kg)</span></label>
                                <input type="number" step="0.01" id="h-weight" class="form-control" placeholder="0.00"/>
                            </div>
                            <div class="form-group">
                                <label><span data-i18n="lbl_volume">Volumen (m³)</span></label>
                                <input type="number" step="0.01" id="h-volume" class="form-control" placeholder="0.00"/>
                            </div>

                            <div class="form-group full-width">
                                <label><span data-i18n="lbl_desc">Descripción Mercancía</span></label>
                                <textarea id="h-desc" class="form-control" rows="2" data-i18n-placeholder="ph_desc" placeholder="Descripción general de la carga..."></textarea>
                            </div>
                            
                            <!-- NUEVO: SUBIDA DE ARCHIVOS -->
                            <div class="form-group full-width mt-2">
                                <label><i class="fa fa-paperclip me-1"></i> <span data-i18n="lbl_files">Adjuntar Documentos del Contenedor (PDF, Imágenes, Excel)</span></label>
                                <input type="file" id="h-files" class="form-control" multiple="multiple" accept=".pdf,.jpg,.jpeg,.png,.xlsx,.xls"/>
                                <small class="text-muted">Seleccione múltiples archivos si es necesario.</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LISTA DE CONTENEDORES YA AGREGADOS (STAGED) -->
                <div id="staged-containers-area" class="mb-4 d-none">
                    <h5 class="text-white mb-2"><i class="fa fa-check-square-o me-2 text-success"></i> <span data-i18n="lbl_staged_title">Contenedores Listos para Enviar</span></h5>
                    <div class="table-responsive">
                        <table class="table table-dark table-sm table-bordered">
                            <thead>
                                <tr class="bg-secondary">
                                    <th>Contenedor</th>
                                    <th>Tipo</th>
                                    <th>Peso (kg)</th>
                                    <th>Vol (m³)</th>
                                    <th>Líneas</th>
                                    <th>Archivos</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="staged-containers-tbody">
                                <!-- JS llenará esto -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- PACKING LIST -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="text-white m-0"><i class="fa fa-list-ul me-2 text-warning"/> <span data-i18n="pl_title">Detalle de Placas (Packing List)</span></h4>
                </div>

                <div class="alert alert-dark border border-secondary text-light mb-4" style="background: #1a1a1a;">
                    <small><i class="fa fa-info-circle text-warning me-1"/> <span data-i18n="pl_instruction">Ingrese las dimensiones de cada placa. El campo 'Contenedor' se llenará automáticamente al agregar el Packing List.</span></small>
                </div>

                <div id="portal-rows-container">
                    <div class="text-center py-5 text-muted">
                        <i class="fa fa-circle-o-notch fa-spin fa-2x"></i>
                        <p class="mt-2" data-i18n="loading">Cargando...</p>
                    </div>
                </div>
            </div>

            <!-- FOOTER CON NUEVOS BOTONES -->
            <div class="submit-footer">
                <div class="summary">
                    <div><span data-i18n="footer_total_plates">Total Placas (Actual):</span> <span id="total-plates">0</span></div>
                    <div>
                        <span data-i18n="footer_total_area">Total Área (Actual):</span> 
                        <span id="total-area">0.00</span> 
                        <span>m²</span>
                    </div>
                </div>
                
                <div class="d-flex gap-2">
                    <!-- BOTÓN AGREGAR SIGUIENTE -->
                    <button id="btn-add-next" class="btn btn-warning rounded-pill px-4 fw-bold">
                        <i class="fa fa-plus me-2"/> <span data-i18n="btn_add_next">Guardar Contenedor y Agregar Otro</span>
                    </button>

                    <!-- BOTÓN FINALIZAR -->
                    <button id="btn-submit-pl" class="btn-primary-custom" disabled="disabled">
                        <i class="fa fa-paper-plane me-2"/> <span data-i18n="btn_submit">Finalizar y Enviar Todo</span>
                    </button>
                </div>
            </div>

        </div>
    </t>
</templates>